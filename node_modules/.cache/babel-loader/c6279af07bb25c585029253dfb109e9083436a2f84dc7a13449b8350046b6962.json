{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{Link,Redirect}from\"react-router-dom\";import UserAPI from\"../API/UserAPI\";import{addSession}from\"../Redux/Action/ActionSession\";import\"./Auth.css\";import queryString from\"query-string\";import CartAPI from\"../API/CartAPI\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function SignIn(props){//listCart Ä‘Æ°á»£c láº¥y tá»« redux\nconst listCart=useSelector(state=>state.Cart.listCart);const[email,setEmail]=useState(\"\");const[password,setPassword]=useState(\"\");const[user,setUser]=useState([]);const[errorEmail,setErrorEmail]=useState(false);const[emailRegex,setEmailRegex]=useState(false);const[errorPassword,setErrorPassword]=useState(false);const[redirect,setRedirect]=useState(false);const[checkPush,setCheckPush]=useState(false);const dispatch=useDispatch();const onChangeEmail=e=>{setEmail(e.target.value);};const onChangePassword=e=>{setPassword(e.target.value);};const onSubmit=()=>{setErrorPassword(false);setEmailRegex(false);if(!email){console.log(\"khong co ky tu trong truong email\");setErrorEmail(true);return;}if(!password){console.log(\"khong co ky tu trong truong pass\");setErrorEmail(false);setErrorPassword(true);return;}if(!validateEmail(email)){setEmailRegex(true);return;}const postLogin=async()=>{try{const res=await UserAPI.postLogin({email,password});console.log(\"ðŸš€ ~ postLogin ~ res:\",res);localStorage.setItem(\"user\",JSON.stringify(res));const action=addSession(JSON.parse(localStorage.getItem(\"user\"))._id);dispatch(action);setCheckPush(true);if(res.role===\"admin\"){window.location=`http://localhost:3001`;return;}}catch(error){console.log(\"ðŸš€ ~ postLogin ~ error:\",error);}};postLogin();};//HÃ m nÃ y dÃ¹ng Ä‘á»ƒ Ä‘Æ°a háº¿t táº¥t cáº£ carts vÃ o API cá»§a user\nuseEffect(()=>{const fetchData=async()=>{//Láº§n Ä‘áº§u sáº½ khÃ´ng thá»±c hiá»‡n insert Ä‘Æ°á»£c vÃ¬ addCart = ''\nif(checkPush===true){for(let i=0;i<listCart.length;i++){//NÃ³ sáº½ láº¥y idUser vÃ  idProduct vÃ  count cáº§n thÃªm Ä‘á»ƒ gá»­i lÃªn server\nconst params={idUser:localStorage.getItem(\"id_user\"),idProduct:listCart[i].idProduct,count:listCart[i].count};const query=\"?\"+queryString.stringify(params);const response=await CartAPI.postAddToCart(query);console.log(response);}setRedirect(true);}};fetchData();},[checkPush]);function validateEmail(email){const regex=/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;return regex.test(String(email).toLowerCase());}return/*#__PURE__*/_jsx(\"div\",{className:\"limiter\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container-login100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrap-login100 p-l-55 p-r-55 p-t-65 p-b-50\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"login100-form-title p-b-33\",children:\"Sign In\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center pb-5\",children:[emailRegex&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Incorrect Email Format\"}),errorEmail&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Email\"}),errorPassword&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Password\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"wrap-input100 validate-input\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input100\",type:\"text\",placeholder:\"Email\",value:email,onChange:onChangeEmail})}),/*#__PURE__*/_jsx(\"div\",{className:\"wrap-input100 rs1 validate-input\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input100\",type:\"password\",placeholder:\"Password\",value:password,onChange:onChangePassword})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container-login100-form-btn m-t-20\",children:[redirect&&/*#__PURE__*/_jsx(Redirect,{to:`/`}),/*#__PURE__*/_jsx(\"button\",{className:\"login100-form-btn\",onClick:onSubmit,children:\"Sign in\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center p-t-45 p-b-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"txt1\",children:\"Create an account?\"}),\"\\xA0\",/*#__PURE__*/_jsx(Link,{to:\"/signup\",className:\"txt2 hov1\",children:\"Sign up\"})]})]})})});}export default SignIn;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","Link","Redirect","UserAPI","addSession","queryString","CartAPI","jsx","_jsx","jsxs","_jsxs","SignIn","props","listCart","state","Cart","email","setEmail","password","setPassword","user","setUser","errorEmail","setErrorEmail","emailRegex","setEmailRegex","errorPassword","setErrorPassword","redirect","setRedirect","checkPush","setCheckPush","dispatch","onChangeEmail","e","target","value","onChangePassword","onSubmit","console","log","validateEmail","postLogin","res","localStorage","setItem","JSON","stringify","action","parse","getItem","_id","role","window","location","error","fetchData","i","length","params","idUser","idProduct","count","query","response","postAddToCart","regex","test","String","toLowerCase","className","children","type","placeholder","onChange","to","onClick"],"sources":["E:/web/NJS301x_1.0/assignment/asm-njs-03/client/src/Authentication/SignIn.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport UserAPI from \"../API/UserAPI\";\nimport { addSession } from \"../Redux/Action/ActionSession\";\nimport \"./Auth.css\";\nimport queryString from \"query-string\";\nimport CartAPI from \"../API/CartAPI\";\n\nfunction SignIn(props) {\n   //listCart Ä‘Æ°á»£c láº¥y tá»« redux\n   const listCart = useSelector((state) => state.Cart.listCart);\n\n   const [email, setEmail] = useState(\"\");\n\n   const [password, setPassword] = useState(\"\");\n\n   const [user, setUser] = useState([]);\n\n   const [errorEmail, setErrorEmail] = useState(false);\n   const [emailRegex, setEmailRegex] = useState(false);\n   const [errorPassword, setErrorPassword] = useState(false);\n\n   const [redirect, setRedirect] = useState(false);\n\n   const [checkPush, setCheckPush] = useState(false);\n\n   const dispatch = useDispatch();\n\n   const onChangeEmail = (e) => {\n      setEmail(e.target.value);\n   };\n\n   const onChangePassword = (e) => {\n      setPassword(e.target.value);\n   };\n\n   const onSubmit = () => {\n      setErrorPassword(false);\n      setEmailRegex(false);\n      if (!email) {\n         console.log(\"khong co ky tu trong truong email\");\n         setErrorEmail(true);\n         return;\n      }\n      if (!password) {\n         console.log(\"khong co ky tu trong truong pass\");\n         setErrorEmail(false);\n         setErrorPassword(true);\n         return;\n      }\n      if (!validateEmail(email)) {\n         setEmailRegex(true);\n         return;\n      }\n      const postLogin = async () => {\n         try {\n            const res = await UserAPI.postLogin({\n               email,\n               password,\n            });\n            console.log(\"ðŸš€ ~ postLogin ~ res:\", res);\n            localStorage.setItem(\"user\", JSON.stringify(res));\n            const action = addSession(JSON.parse(localStorage.getItem(\"user\"))._id);\n            dispatch(action);\n            setCheckPush(true);\n            if (res.role === \"admin\") {\n               window.location = `http://localhost:3001`;\n               return;\n            }\n         } catch (error) {\n            console.log(\"ðŸš€ ~ postLogin ~ error:\", error);\n         }\n      };\n      postLogin();\n   };\n\n   //HÃ m nÃ y dÃ¹ng Ä‘á»ƒ Ä‘Æ°a háº¿t táº¥t cáº£ carts vÃ o API cá»§a user\n   useEffect(() => {\n      const fetchData = async () => {\n         //Láº§n Ä‘áº§u sáº½ khÃ´ng thá»±c hiá»‡n insert Ä‘Æ°á»£c vÃ¬ addCart = ''\n         if (checkPush === true) {\n            for (let i = 0; i < listCart.length; i++) {\n               //NÃ³ sáº½ láº¥y idUser vÃ  idProduct vÃ  count cáº§n thÃªm Ä‘á»ƒ gá»­i lÃªn server\n               const params = {\n                  idUser: localStorage.getItem(\"id_user\"),\n                  idProduct: listCart[i].idProduct,\n                  count: listCart[i].count,\n               };\n\n               const query = \"?\" + queryString.stringify(params);\n\n               const response = await CartAPI.postAddToCart(query);\n               console.log(response);\n            }\n\n            setRedirect(true);\n         }\n      };\n\n      fetchData();\n   }, [checkPush]);\n\n   function validateEmail(email) {\n      const regex =\n         /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n      return regex.test(String(email).toLowerCase());\n   }\n\n   return (\n      <div className='limiter'>\n         <div className='container-login100'>\n            <div className='wrap-login100 p-l-55 p-r-55 p-t-65 p-b-50'>\n               <span className='login100-form-title p-b-33'>Sign In</span>\n\n               <div className='d-flex justify-content-center pb-5'>\n                  {emailRegex && <span className='text-danger'>* Incorrect Email Format</span>}\n                  {errorEmail && <span className='text-danger'>* Please Check Your Email</span>}\n                  {errorPassword && <span className='text-danger'>* Please Check Your Password</span>}\n               </div>\n\n               <div className='wrap-input100 validate-input'>\n                  <input className='input100' type='text' placeholder='Email' value={email} onChange={onChangeEmail} />\n               </div>\n\n               <div className='wrap-input100 rs1 validate-input'>\n                  <input\n                     className='input100'\n                     type='password'\n                     placeholder='Password'\n                     value={password}\n                     onChange={onChangePassword}\n                  />\n               </div>\n\n               <div className='container-login100-form-btn m-t-20'>\n                  {redirect && <Redirect to={`/`} />}\n                  <button className='login100-form-btn' onClick={onSubmit}>\n                     Sign in\n                  </button>\n               </div>\n\n               <div className='text-center p-t-45 p-b-4'>\n                  <span className='txt1'>Create an account?</span>\n                  &nbsp;\n                  <Link to='/signup' className='txt2 hov1'>\n                     Sign up\n                  </Link>\n               </div>\n            </div>\n         </div>\n      </div>\n   );\n}\n\nexport default SignIn;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}